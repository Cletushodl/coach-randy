<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coach Randy the Trainer</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#000000;--surface:#1c1c1e;--surface2:#2c2c2e;--border:#38383a;
  --accent:#06b6d4;--accent2:#06b6d4;--accent-glow:rgba(6,182,212,.1);
  --green:#30d158;--red:#ff453a;--amber:#ffd60a;--pink:#ff375f;
  --text:#f5f5f7;--text2:#86868b;--text3:#48484a;
  --radius:14px;--radius-sm:10px;
}
body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'SF Pro Display',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;-webkit-font-smoothing:antialiased}

/* Toast */
.toast{position:fixed;top:24px;right:24px;background:var(--surface);border:1px solid var(--green);color:var(--green);padding:14px 24px;border-radius:var(--radius-sm);font-size:.875rem;font-weight:500;z-index:1000;transform:translateX(120%);transition:transform .4s cubic-bezier(.16,1,.3,1);backdrop-filter:blur(12px);display:flex;align-items:center;gap:8px}
.toast.show{transform:translateX(0)}
.toast svg{width:18px;height:18px;flex-shrink:0}

/* Header */
.header{padding:48px 24px 36px;text-align:center}
.header-content{position:relative;z-index:1}
.header h1{font-size:2rem;font-weight:700;letter-spacing:-.03em;color:var(--text)}
.header p{color:var(--text2);font-size:.9375rem;margin-top:8px;font-weight:400}

/* Nav */
.nav{display:flex;gap:2px;padding:6px 16px;background:rgba(28,28,30,.8);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid rgba(255,255,255,.08);overflow-x:auto;position:sticky;top:0;z-index:10;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.nav::-webkit-scrollbar{display:none}
.nav button{background:transparent;border:none;color:var(--text2);padding:8px 16px;border-radius:999px;cursor:pointer;white-space:nowrap;font-size:.8125rem;font-weight:500;font-family:inherit;transition:all .2s ease}
.nav button:hover{color:var(--text)}
.nav button.active{color:#fff;background:rgba(255,255,255,.1);font-weight:600}

/* Sections */
.section{display:none;padding:24px 16px 80px;max-width:960px;margin:0 auto;opacity:0;transform:translateY(8px);transition:opacity .35s ease,transform .35s ease}
.section.active{display:block;opacity:1;transform:translateY(0)}
.section-title{font-size:1.125rem;font-weight:700;margin-bottom:20px;letter-spacing:-.01em;display:flex;align-items:center;gap:10px}

/* Cards Grid */
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:14px;margin-bottom:28px}
.card{background:var(--surface);border-radius:var(--radius);padding:20px;position:relative;transition:transform .2s ease}
.card:hover{transform:scale(1.02)}
.card-icon{font-size:1.25rem;margin-bottom:8px}
.card .big{font-size:2rem;font-weight:700;letter-spacing:-.03em;color:var(--text)}
.card .label{font-size:.6875rem;color:var(--text2);margin-top:6px;text-transform:uppercase;letter-spacing:.06em;font-weight:500}

/* Chart Box */
.chart-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media(max-width:600px){.chart-grid{grid-template-columns:1fr}}
.chart-box{background:var(--surface);border-radius:var(--radius);padding:20px;margin-bottom:14px}
.chart-box h3{font-size:.75rem;font-weight:600;color:var(--text2);margin-bottom:14px;text-transform:uppercase;letter-spacing:.05em}
.chart-box canvas{max-height:200px}
canvas{max-height:260px}

/* Empty State */
.run-card{background:var(--surface);border-radius:var(--radius);padding:20px;margin-bottom:12px}
.run-card-header{font-size:.875rem;font-weight:600;margin-bottom:14px;color:var(--text2)}
.run-card-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(90px,1fr));gap:10px}
.run-stat{text-align:center}
.run-stat-val{display:block;font-size:1.1rem;font-weight:700;color:var(--text)}
.run-stat-lbl{display:block;font-size:.6875rem;color:var(--text2);text-transform:uppercase;margin-top:3px;letter-spacing:.04em}
.empty-state{text-align:center;padding:48px 24px;color:var(--text3)}
.empty-state .icon{font-size:2.5rem;margin-bottom:12px}
.empty-state p{font-size:.875rem;color:var(--text2)}

/* Table */
.table-wrap{overflow-x:auto;border-radius:var(--radius);background:var(--surface)}
table{width:100%;border-collapse:collapse;font-size:.8125rem}
th{padding:12px 14px;text-align:left;color:var(--text2);font-weight:600;font-size:.6875rem;text-transform:uppercase;letter-spacing:.06em;border-bottom:1px solid var(--border);cursor:pointer;user-select:none;white-space:nowrap;transition:color .15s;background:var(--surface2)}
th:hover{color:var(--text)}
th .sort-indicator{opacity:.3;margin-left:4px;font-size:.625rem}
th.sorted .sort-indicator{opacity:1;color:var(--accent)}
td{padding:10px 14px;border-bottom:1px solid rgba(48,54,61,.5);color:var(--text);transition:background .1s}
tbody tr:nth-child(even){background:rgba(255,255,255,.015)}
tbody tr:hover{background:rgba(6,182,212,.04)}
tbody tr:last-child td{border-bottom:none}
.type-badge{display:inline-block;padding:2px 10px;border-radius:999px;font-size:.6875rem;font-weight:600;letter-spacing:.02em}
.type-badge.run{background:rgba(6,182,212,.12);color:var(--accent)}
.type-badge.strength{background:rgba(6,182,212,.12);color:var(--accent)}
.type-badge.cycle{background:rgba(245,158,11,.12);color:var(--amber)}

/* Forms */
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.form-group{position:relative;margin-bottom:0}
.form-group label{display:block;font-size:.6875rem;color:var(--text2);margin-bottom:6px;font-weight:500;text-transform:uppercase;letter-spacing:.05em}
.form-group input,.form-group select{width:100%;padding:12px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text);font-size:.875rem;font-family:inherit;transition:border-color .2s,box-shadow .2s;outline:none}
.form-group input:focus,.form-group select:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-glow)}
.form-group input::placeholder{color:var(--text3)}
.form-group select{cursor:pointer;-webkit-appearance:none;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%238b949e' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center}
.btn{background:var(--accent);border:none;color:#000;padding:14px 28px;border-radius:var(--radius-sm);cursor:pointer;font-size:.875rem;font-weight:600;font-family:inherit;width:100%;margin-top:8px;transition:opacity .2s}
.btn:hover{opacity:.85}
.btn:active{opacity:.7}

/* PR Items */
.pr-item{background:var(--surface);border-radius:var(--radius);padding:18px 20px;margin-bottom:12px;display:flex;align-items:center;gap:16px}
.pr-item .pr-icon{font-size:1.5rem;flex-shrink:0}
.pr-item .pr-content{flex:1}
.pr-item .val{font-size:1.25rem;font-weight:700;color:var(--green)}
.pr-item .desc{font-size:.75rem;color:var(--text2);margin-top:2px}

/* Footer */
.footer{text-align:center;padding:32px 16px;margin-top:0}
.footer p{font-size:.75rem;color:var(--text3);font-weight:400;letter-spacing:.02em}
.footer span{color:var(--text2);font-weight:600}

/* Scrollbar */
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--text3)}

/* Mobile */
@media(max-width:600px){
  .form-grid{grid-template-columns:1fr}
  .cards{grid-template-columns:repeat(2,1fr)}
  .header{padding:28px 16px 24px}
  .header h1{font-size:1.4rem}
  .section{padding:16px 12px 80px}
  .pr-item{flex-direction:column;align-items:flex-start;gap:8px}
}
</style>
</head>
<body>
<div class="header"><div class="header-content">
<h1>üèãÔ∏è Coach Randy the Trainer</h1>
<p>Track ¬∑ Train ¬∑ Transform</p>
</div></div>

<div class="nav" id="nav">
<button class="active" data-tab="dashboard">Dashboard</button>
<button data-tab="runlist">All Runs</button>
<button data-tab="runs">Run Trends</button>
<button data-tab="body">Body Comp</button>
<button data-tab="log">Workout Log</button>
<button data-tab="add">Add Workout</button>
<button data-tab="addcomp">Add Body Comp</button>
<button data-tab="stats">Stats / PRs</button>
</div>

<div id="dashboard" class="section active">
<div class="cards">
<div class="card"><div class="card-icon">üèÉ</div><div class="big" id="totalMiles">0</div><div class="label">Total Miles</div></div>
<div class="card"><div class="card-icon">üí™</div><div class="big" id="totalWorkouts">0</div><div class="label">Workouts</div></div>
<div class="card"><div class="card-icon">üî•</div><div class="big" id="totalCals">0</div><div class="label">Calories</div></div>
<div class="card"><div class="card-icon">üëü</div><div class="big" id="totalRuns">0</div><div class="label">Runs</div></div>
</div>
<div class="chart-box"><h3>Weekly Summary</h3><canvas id="weeklyChart"></canvas></div>
<div id="progressSummary" class="chart-box"></div>
</div>

<div id="runlist" class="section">
<div class="section-title">üèÉ All Runs</div>
<div id="runCards"></div>
</div>

<div id="runs" class="section">
<div class="chart-grid">
<div class="chart-box"><h3>Pace Over Time (min/mi)</h3><canvas id="paceChart"></canvas></div>
<div class="chart-box"><h3>Heart Rate Over Time</h3><canvas id="hrChart"></canvas></div>
<div class="chart-box"><h3>Distance Over Time</h3><canvas id="distChart"></canvas></div>
<div class="chart-box"><h3>Cadence Over Time</h3><canvas id="cadChart"></canvas></div>
</div>
</div>

<div id="body" class="section">
<div class="chart-grid">
<div class="chart-box"><h3>Weight Over Time</h3><canvas id="weightChart"></canvas></div>
<div class="chart-box"><h3>Body Fat % Over Time</h3><canvas id="bfChart"></canvas></div>
<div class="chart-box"><h3>Muscle Mass Over Time</h3><canvas id="muscleChart"></canvas></div>
<div class="chart-box"><h3>Fat-Free Weight Over Time</h3><canvas id="ffwChart"></canvas></div>
</div>
</div>

<div id="log" class="section">
<div class="section-title">üìã Workout Log</div>
<div class="table-wrap">
<table id="logTable">
<thead><tr>
<th data-col="date">Date <span class="sort-indicator">‚ñ≤‚ñº</span></th>
<th data-col="type">Type <span class="sort-indicator">‚ñ≤‚ñº</span></th>
<th data-col="duration">Time <span class="sort-indicator">‚ñ≤‚ñº</span></th>
<th data-col="distance">Dist <span class="sort-indicator">‚ñ≤‚ñº</span></th>
<th data-col="pace">Pace <span class="sort-indicator">‚ñ≤‚ñº</span></th>
<th data-col="hr">HR <span class="sort-indicator">‚ñ≤‚ñº</span></th>
<th data-col="cadence">SPM <span class="sort-indicator">‚ñ≤‚ñº</span></th>
<th data-col="calories">Cal <span class="sort-indicator">‚ñ≤‚ñº</span></th>
<th data-col="elevation">Elev <span class="sort-indicator">‚ñ≤‚ñº</span></th>
</tr></thead>
<tbody></tbody>
</table>
</div>
</div>

<div id="add" class="section">
<div class="section-title">‚ûï Add Workout</div>
<div class="form-grid">
<div class="form-group"><label>Type</label><select id="wType"><option value="Run">Run</option><option value="Strength">Strength</option><option value="Indoor Cycle">Indoor Cycle</option></select></div>
<div class="form-group"><label>Date</label><input type="date" id="wDate"></div>
<div class="form-group"><label>Duration (mm:ss)</label><input id="wDuration" placeholder="31:44"></div>
<div class="form-group"><label>Distance (mi)</label><input type="number" step="0.01" id="wDist" placeholder="0.00"></div>
<div class="form-group"><label>Pace (e.g. 12'39")</label><input id="wPace" placeholder="12'39&quot;"></div>
<div class="form-group"><label>Avg HR (BPM)</label><input type="number" id="wHR" placeholder="145"></div>
<div class="form-group"><label>Cadence (SPM)</label><input type="number" id="wCad" placeholder="150"></div>
<div class="form-group"><label>Calories</label><input type="number" id="wCal" placeholder="350"></div>
<div class="form-group"><label>Elevation (ft)</label><input type="number" id="wElev" placeholder="50"></div>
</div>
<button class="btn" onclick="addWorkout()">Save Workout</button>
</div>

<div id="addcomp" class="section">
<div class="section-title">üìä Add Body Composition</div>
<div class="form-grid">
<div class="form-group"><label>Date</label><input type="date" id="cDate"></div>
<div class="form-group"><label>Weight (lbs)</label><input type="number" step="0.1" id="cWeight" placeholder="220.0"></div>
<div class="form-group"><label>BMI</label><input type="number" step="0.1" id="cBMI" placeholder="30.0"></div>
<div class="form-group"><label>Body Fat %</label><input type="number" step="0.1" id="cBF" placeholder="18.0"></div>
<div class="form-group"><label>Muscle Mass</label><input type="number" step="0.1" id="cMuscle" placeholder="173.0"></div>
<div class="form-group"><label>Skeletal Muscle %</label><input type="number" step="0.1" id="cSkeletal" placeholder="53.0"></div>
<div class="form-group"><label>Fat-Free Weight</label><input type="number" step="0.1" id="cFatFree" placeholder="182.0"></div>
<div class="form-group"><label>Visceral Fat</label><input type="number" id="cVisceral" placeholder="12"></div>
</div>
<button class="btn" onclick="addComp()">Save Body Comp</button>
</div>

<div id="stats" class="section">
<div class="section-title">üèÜ Personal Records</div>
<div id="prList"></div>
</div>

<div class="footer"><p>Built with üí™ by <span>Coach Randy the Trainer</span></p></div>

<!-- Toast -->
<div class="toast" id="toast"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"/></svg><span id="toastMsg">Saved!</span></div>

<script>
const SEED_WORKOUTS=[
{date:"2026-01-16",type:"Run",duration:"31:44",distance:2.50,pace:"12'39\"",hr:164,cadence:133,calories:365,elevation:94},
{date:"2026-01-19",type:"Run",duration:"41:00",distance:3.52,pace:"11'39\"",hr:172,cadence:151,calories:388,elevation:27},
{date:"2026-01-21",type:"Run",duration:"46:46",distance:4.01,pace:"11'40\"",hr:166,cadence:151,calories:445,elevation:null},
{date:"2026-01-22",type:"Strength",duration:"31:22",distance:null,pace:null,hr:124,cadence:null,calories:285,elevation:null},
{date:"2026-01-23",type:"Run",duration:"40:36",distance:3.00,pace:"13'29\"",hr:143,cadence:139,calories:415,elevation:28},
{date:"2026-01-24",type:"Indoor Cycle",duration:"30:02",distance:null,pace:null,hr:138,cadence:null,calories:317,elevation:null},
{date:"2026-01-26",type:"Run",duration:"36:09",distance:2.80,pace:"12'55\"",hr:149,cadence:134,calories:225,elevation:8},
{date:"2026-01-27",type:"Strength",duration:"31:38",distance:null,pace:null,hr:127,cadence:null,calories:228,elevation:null},
{date:"2026-01-28",type:"Run",duration:"1:14:01",distance:6.00,pace:"12'19\"",hr:151,cadence:154,calories:690,elevation:56}
];
const SEED_COMP=[
{date:"2026-01-12",weight:222.2,bmi:30.4,bf:17.8,muscle:173.6,skeletal:53.1,fatfree:182.6,visceral:12},
{date:"2026-01-16",weight:220.2,bmi:30.1,bf:17.6,muscle:172.4,skeletal:53.2,fatfree:181.4,visceral:12},
{date:"2026-01-19",weight:221.8,bmi:30.4,bf:17.8,muscle:173.0,skeletal:53.1,fatfree:182.0,visceral:12},
{date:"2026-01-22",weight:222.6,bmi:30.5,bf:17.9,muscle:173.8,skeletal:53.0,fatfree:182.8,visceral:13},
{date:"2026-01-26",weight:227.0,bmi:31.1,bf:18.3,muscle:176.2,skeletal:52.8,fatfree:185.4,visceral:13}
];

const DATA_VERSION='v2';
function load(key,seed){
  if(localStorage.getItem('cr_version')!==DATA_VERSION){
    localStorage.removeItem('cr_workouts');
    localStorage.removeItem('cr_comps');
    localStorage.setItem('cr_version',DATA_VERSION);
  }
  let stored=JSON.parse(localStorage.getItem(key)||'[]');
  let dates=new Set(stored.map(r=>r.date+JSON.stringify(r)));
  seed.forEach(s=>{if(!dates.has(s.date+JSON.stringify(s)))stored.push(s)});
  stored.sort((a,b)=>a.date.localeCompare(b.date));
  localStorage.setItem(key,JSON.stringify(stored));
  return stored;
}
let workouts=load('cr_workouts',SEED_WORKOUTS);
let comps=load('cr_comps',SEED_COMP);
let charts={};

function showToast(msg){
  const t=document.getElementById('toast');
  document.getElementById('toastMsg').textContent=msg;
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2500);
}

// Nav
document.getElementById('nav').addEventListener('click',e=>{
  if(e.target.tagName!=='BUTTON')return;
  const tab=e.target.dataset.tab;
  document.querySelectorAll('.section').forEach(s=>{s.classList.remove('active');s.style.display='none'});
  document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
  const sec=document.getElementById(tab);
  sec.style.display='block';
  // trigger reflow for animation
  void sec.offsetWidth;
  sec.classList.add('active');
  e.target.classList.add('active');
  // Lazy-render charts on first visit
  if(tab==='runlist')renderRunList();
  if(tab==='runs'&&!charts.pace)renderRunCharts();
  if(tab==='body'&&!charts.weight)renderBodyCharts();
});

function paceToMin(p){if(!p)return null;let m=p.match(/(\d+)'(\d+)/);return m?+m[1]+ +m[2]/60:null;}
function fmt(n,d=1){return n!=null?n.toFixed(d):'-';}
function shortDate(d){let dt=new Date(d+'T12:00:00');return(dt.getMonth()+1)+'/'+dt.getDate();}
function weekLabel(sunStr){let s=new Date(sunStr+'T12:00:00');let e=new Date(s);e.setDate(s.getDate()+6);return(s.getMonth()+1)+'/'+s.getDate()+'‚Äì'+(e.getMonth()+1)+'/'+e.getDate();}

// Chart defaults
Chart.defaults.color='#8b949e';
Chart.defaults.borderColor='rgba(48,54,61,.5)';
Chart.defaults.font.family='Inter, system-ui, sans-serif';
Chart.defaults.font.size=11;

const baseOpts={responsive:true,maintainAspectRatio:true,interaction:{intersect:false,mode:'index'},plugins:{legend:{display:false},tooltip:{backgroundColor:'#161b22',borderColor:'#30363d',borderWidth:1,titleColor:'#e6edf3',bodyColor:'#8b949e',cornerRadius:8,padding:10,titleFont:{weight:600}}},scales:{x:{grid:{display:false},ticks:{maxRotation:0,autoSkipPadding:12}},y:{grid:{color:'rgba(48,54,61,.3)',drawBorder:false},ticks:{padding:8},border:{display:false}}}};

function makeGradient(ctx,color){
  const g=ctx.createLinearGradient(0,0,0,260);
  g.addColorStop(0,color+'40');
  g.addColorStop(1,color+'00');
  return g;
}

function renderDash(){
  let runs=workouts.filter(w=>w.type==='Run');
  let totalMi=workouts.reduce((s,w)=>s+(w.distance||0),0);
  let totalCal=workouts.reduce((s,w)=>s+(w.calories||0),0);
  document.getElementById('totalMiles').textContent=fmt(totalMi,1);
  document.getElementById('totalWorkouts').textContent=workouts.length;
  document.getElementById('totalCals').textContent=totalCal.toLocaleString();
  document.getElementById('totalRuns').textContent=runs.length;

  let weeks={};
  workouts.forEach(w=>{
    let d=new Date(w.date+'T12:00:00');
    let day=d.getDay();
    let mon=new Date(d);mon.setDate(d.getDate()-day);
    let key=mon.toISOString().slice(0,10);
    if(!weeks[key])weeks[key]={mi:0,cal:0,cnt:0};
    weeks[key].mi+=w.distance||0;
    weeks[key].cal+=w.calories||0;
    weeks[key].cnt++;
  });
  let wks=Object.keys(weeks).sort();
  if(charts.weekly)charts.weekly.destroy();
  const ctx=document.getElementById('weeklyChart').getContext('2d');
  charts.weekly=new Chart(ctx,{type:'bar',data:{labels:wks.map(k=>weekLabel(k)),datasets:[
    {label:'Miles',data:wks.map(k=>weeks[k].mi),backgroundColor:'rgba(6,182,212,.7)',borderRadius:6,borderSkipped:false},
    {label:'Workouts',data:wks.map(k=>weeks[k].cnt),backgroundColor:'rgba(124,58,237,.6)',borderRadius:6,borderSkipped:false}
  ]},options:{...baseOpts,plugins:{...baseOpts.plugins,legend:{display:true,labels:{usePointStyle:true,pointStyle:'circle',padding:16,color:'#8b949e',font:{size:11}}}}}});
}

function renderProgressSummary(){
  let el=document.getElementById('progressSummary');
  let runs=workouts.filter(w=>w.type==='Run'&&w.hr&&w.pace).sort((a,b)=>a.date.localeCompare(b.date));
  if(runs.length<2){el.style.display='none';return;}

  let first=runs.slice(0,Math.ceil(runs.length/2));
  let second=runs.slice(Math.ceil(runs.length/2));
  let avgHR=arr=>Math.round(arr.reduce((s,r)=>s+r.hr,0)/arr.length);
  let avgPace=arr=>{let p=arr.map(r=>paceToMin(r.pace)).filter(Boolean);return p.length?p.reduce((s,v)=>s+v,0)/p.length:null;};
  let totalMi=workouts.filter(w=>w.type==='Run').reduce((s,w)=>s+(w.distance||0),0);
  let totalWorkouts=workouts.length;
  
  let earlyHR=avgHR(first), lateHR=avgHR(second);
  let earlyPace=avgPace(first), latePace=avgPace(second);
  let hrDelta=earlyHR-lateHR;
  let paceDelta=earlyPace&&latePace?(earlyPace-latePace):null;
  
  let longest=runs.reduce((a,b)=>(a.distance||0)>(b.distance||0)?a:b);
  let firstDate=new Date(runs[0].date+'T12:00:00');
  let lastDate=new Date(runs[runs.length-1].date+'T12:00:00');
  let days=Math.round((lastDate-firstDate)/(1000*60*60*24));
  
  let lines=[];
  lines.push(`<h3>üìä Progress Summary</h3>`);
  lines.push(`<div style="font-size:.875rem;line-height:1.7;color:var(--text2);margin-top:8px">`);
  lines.push(`<p style="margin-bottom:10px">Over <strong style="color:var(--text1)">${days} days</strong> and <strong style="color:var(--text1)">${totalWorkouts} workouts</strong> (${runs.length} runs, ${fmt(totalMi,1)} total miles), here's how you're progressing:</p>`);
  
  // HR conditioning
  lines.push(`<p style="margin-bottom:10px"><strong style="color:var(--accent)">‚ù§Ô∏è Heart Rate Conditioning:</strong> Early runs averaged <strong style="color:var(--text1)">${earlyHR} BPM</strong>, recent runs average <strong style="color:var(--text1)">${lateHR} BPM</strong>.`);
  if(hrDelta>0){
    lines.push(` That's a <strong style="color:#00c853">${hrDelta} BPM drop</strong> ‚Äî your cardiovascular system is adapting. Lower HR at similar effort = stronger aerobic base.`);
  } else if(hrDelta<0){
    lines.push(` HR is up ${Math.abs(hrDelta)} BPM ‚Äî likely pushing harder efforts or increasing distance. Keep monitoring.`);
  }
  lines.push(`</p>`);
  
  // Pace
  if(paceDelta!==null){
    lines.push(`<p style="margin-bottom:10px"><strong style="color:var(--accent)">‚è±Ô∏è Pace:</strong> Early avg <strong style="color:var(--text1)">${Math.floor(earlyPace)}'${String(Math.round((earlyPace%1)*60)).padStart(2,'0')}"</strong>/mi ‚Üí recent <strong style="color:var(--text1)">${Math.floor(latePace)}'${String(Math.round((latePace%1)*60)).padStart(2,'0')}"</strong>/mi.`);
    if(paceDelta>0.1){
      lines.push(` Pace improved by ~${Math.round(paceDelta*60)} seconds/mile. Solid progress.`);
    } else if(paceDelta<-0.1){
      lines.push(` Pace slowed ~${Math.round(Math.abs(paceDelta)*60)}s/mi ‚Äî could be longer distances, smarter pacing, or more zone 2 work. Not necessarily bad.`);
    } else {
      lines.push(` Pace is holding steady ‚Äî consistency is king.`);
    }
    lines.push(`</p>`);
  }
  
  // Distance progression
  lines.push(`<p style="margin-bottom:10px"><strong style="color:var(--accent)">üìè Distance:</strong> Longest run is <strong style="color:var(--text1)">${fmt(longest.distance,2)} mi</strong> (${shortDate(longest.date)}). `);
  if(longest===runs[runs.length-1]||longest===runs[runs.length-2]){
    lines.push(`Recent long run PR ‚Äî distance is trending up. üí™`);
  } else {
    lines.push(`Building a solid mileage base.`);
  }
  lines.push(`</p>`);
  
  // Takeaway
  if(hrDelta>5){
    lines.push(`<p><strong style="color:#00c853">üèÜ Key Takeaway:</strong> Heart rate is dropping while maintaining or improving pace ‚Äî textbook aerobic adaptation. Keep it up.</p>`);
  } else {
    lines.push(`<p><strong style="color:var(--accent)">üèÜ Key Takeaway:</strong> Consistency is building. Keep logging miles and the cardiovascular gains will compound.</p>`);
  }
  
  lines.push(`</div>`);
  el.innerHTML=lines.join('');
}

function renderRunList(){
  let runs=workouts.filter(w=>w.type==='Run').slice().reverse();
  let el=document.getElementById('runCards');
  if(!runs.length){el.innerHTML='<div class="empty-state">No runs logged yet</div>';return;}
  el.innerHTML=runs.map(r=>{
    let paceVal=r.pace||'‚Äî';
    let d=new Date(r.date+'T12:00:00');
    let dayName=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'][d.getDay()];
    let monthName=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'][d.getMonth()];
    let dateStr=dayName+', '+monthName+' '+d.getDate()+', '+d.getFullYear();
    return `<div class="run-card">
      <div class="run-card-header">${dateStr}</div>
      <div class="run-card-stats">
        <div class="run-stat"><span class="run-stat-val">${r.distance!=null?r.distance.toFixed(2):'-'}</span><span class="run-stat-lbl">Miles</span></div>
        <div class="run-stat"><span class="run-stat-val">${r.duration}</span><span class="run-stat-lbl">Duration</span></div>
        <div class="run-stat"><span class="run-stat-val">${paceVal}</span><span class="run-stat-lbl">Pace/mi</span></div>
        <div class="run-stat"><span class="run-stat-val">${r.hr||'-'}</span><span class="run-stat-lbl">Avg HR</span></div>
        <div class="run-stat"><span class="run-stat-val">${r.cadence||'-'}</span><span class="run-stat-lbl">Cadence</span></div>
        <div class="run-stat"><span class="run-stat-val">${r.calories||'-'}</span><span class="run-stat-lbl">Calories</span></div>
        <div class="run-stat"><span class="run-stat-val">${r.elevation!=null?r.elevation+'ft':'-'}</span><span class="run-stat-lbl">Elevation</span></div>
      </div>
    </div>`;
  }).join('');
}

function renderRunCharts(){
  let runs=workouts.filter(w=>w.type==='Run');
  if(!runs.length)return;
  let labels=runs.map(r=>shortDate(r.date));
  function line(id,data,color,label){
    const ctx=document.getElementById(id).getContext('2d');
    const filtered=data.filter(v=>v!=null);
    if(!filtered.length){document.getElementById(id).parentElement.innerHTML='<div class="empty-state"><div class="icon">üìä</div><p>No data yet</p></div>';return null;}
    return new Chart(ctx,{type:'line',data:{labels,datasets:[{label,data,borderColor:color,backgroundColor:makeGradient(ctx,color),tension:.4,fill:true,pointRadius:4,pointBackgroundColor:color,pointBorderColor:'#161b22',pointBorderWidth:2,pointHoverRadius:6,borderWidth:2.5}]},options:baseOpts});
  }
  charts.pace=line('paceChart',runs.map(r=>paceToMin(r.pace)),'#06b6d4','Pace');
  charts.hr=line('hrChart',runs.map(r=>r.hr),'#ef4444','HR');
  charts.dist=line('distChart',runs.map(r=>r.distance),'#10b981','Distance');
  charts.cad=line('cadChart',runs.map(r=>r.cadence),'#f59e0b','Cadence');
}

function renderBodyCharts(){
  if(!comps.length)return;
  let labels=comps.map(c=>shortDate(c.date));
  const ctx1=document.getElementById('weightChart').getContext('2d');
  charts.weight=new Chart(ctx1,{type:'line',data:{labels,datasets:[{label:'Weight (lbs)',data:comps.map(c=>c.weight),borderColor:'#ec4899',backgroundColor:makeGradient(ctx1,'#ec4899'),tension:.4,fill:true,pointRadius:4,pointBackgroundColor:'#ec4899',pointBorderColor:'#161b22',pointBorderWidth:2,borderWidth:2.5}]},options:baseOpts});
  const ctx2=document.getElementById('bfChart').getContext('2d');
  charts.bf=new Chart(ctx2,{type:'line',data:{labels,datasets:[{label:'Body Fat %',data:comps.map(c=>c.bf),borderColor:'#f59e0b',backgroundColor:makeGradient(ctx2,'#f59e0b'),tension:.4,fill:true,pointRadius:4,pointBackgroundColor:'#f59e0b',pointBorderColor:'#161b22',pointBorderWidth:2,borderWidth:2.5}]},options:baseOpts});
  const ctx3=document.getElementById('muscleChart').getContext('2d');
  charts.muscle=new Chart(ctx3,{type:'line',data:{labels,datasets:[{label:'Muscle Mass (lbs)',data:comps.map(c=>c.muscle),borderColor:'#22c55e',backgroundColor:makeGradient(ctx3,'#22c55e'),tension:.4,fill:true,pointRadius:4,pointBackgroundColor:'#22c55e',pointBorderColor:'#161b22',pointBorderWidth:2,borderWidth:2.5}]},options:baseOpts});
  const ctx4=document.getElementById('ffwChart').getContext('2d');
  charts.ffw=new Chart(ctx4,{type:'line',data:{labels,datasets:[{label:'Fat-Free Weight (lbs)',data:comps.map(c=>c.fatfree),borderColor:'#06b6d4',backgroundColor:makeGradient(ctx4,'#06b6d4'),tension:.4,fill:true,pointRadius:4,pointBackgroundColor:'#06b6d4',pointBorderColor:'#161b22',pointBorderWidth:2,borderWidth:2.5}]},options:baseOpts});
}

let sortDir={};
function typeBadge(t){
  const cls=t==='Run'?'run':t==='Strength'?'strength':'cycle';
  return `<span class="type-badge ${cls}">${t}</span>`;
}
function renderLog(){
  let tb=document.querySelector('#logTable tbody');
  let sorted=workouts.slice().reverse();
  tb.innerHTML=sorted.map(w=>`<tr><td>${shortDate(w.date)}</td><td>${typeBadge(w.type)}</td><td>${w.duration}</td><td>${w.distance!=null?fmt(w.distance,2):'-'}</td><td>${w.pace||'-'}</td><td>${w.hr||'-'}</td><td>${w.cadence||'-'}</td><td>${w.calories||'-'}</td><td>${w.elevation!=null?w.elevation+'ft':'-'}</td></tr>`).join('');
}
document.querySelectorAll('#logTable th').forEach(th=>{
  th.addEventListener('click',()=>{
    document.querySelectorAll('#logTable th').forEach(h=>h.classList.remove('sorted'));
    let col=th.dataset.col;
    sortDir[col]=!sortDir[col];
    th.classList.add('sorted');
    th.querySelector('.sort-indicator').textContent=sortDir[col]?'‚ñ≤':'‚ñº';
    workouts.sort((a,b)=>{
      let va=a[col],vb=b[col];
      if(va==null)return 1;if(vb==null)return -1;
      if(typeof va==='string')return sortDir[col]?va.localeCompare(vb):vb.localeCompare(va);
      return sortDir[col]?va-vb:vb-va;
    });
    renderLog();
  });
});

function renderPRs(){
  let runs=workouts.filter(w=>w.type==='Run'&&w.pace);
  if(!runs.length){document.getElementById('prList').innerHTML='<div class="empty-state"><div class="icon">üèÜ</div><p>Complete some runs to see your PRs</p></div>';return;}
  let paces=runs.map(r=>({p:paceToMin(r.pace),d:r.date,raw:r.pace})).filter(x=>x.p);
  let fastest=paces.reduce((a,b)=>a.p<b.p?a:b,paces[0]);
  let longest=runs.reduce((a,b)=>(a.distance||0)>(b.distance||0)?a:b,runs[0]);
  let lowestHR=runs.reduce((a,b)=>(a.hr||999)<(b.hr||999)?a:b,runs[0]);
  let html='';
  if(fastest)html+=`<div class="pr-item"><div class="pr-icon">üèÉ</div><div class="pr-content"><div class="val">${fastest.raw}/mi</div><div class="desc">Fastest Pace ‚Äî ${shortDate(fastest.d)}</div></div></div>`;
  if(longest)html+=`<div class="pr-item"><div class="pr-icon">üìè</div><div class="pr-content"><div class="val">${fmt(longest.distance,2)} mi</div><div class="desc">Longest Run ‚Äî ${shortDate(longest.date)}</div></div></div>`;
  if(lowestHR)html+=`<div class="pr-item"><div class="pr-icon">‚ù§Ô∏è</div><div class="pr-content"><div class="val">${lowestHR.hr} BPM</div><div class="desc">Lowest Avg HR on Run ‚Äî ${shortDate(lowestHR.date)}</div></div></div>`;
  let maxHRrun=runs.filter(r=>r.hr).reduce((a,b)=>(a.hr||0)>(b.hr||0)?a:b,runs[0]);
  if(maxHRrun&&maxHRrun.hr)html+=`<div class="pr-item"><div class="pr-icon">üî•</div><div class="pr-content"><div class="val">${maxHRrun.hr} BPM</div><div class="desc">Max Avg HR on Run ‚Äî ${shortDate(maxHRrun.date)}</div></div></div>`;
  let totalMi=workouts.reduce((s,w)=>s+(w.distance||0),0);
  html+=`<div class="pr-item"><div class="pr-icon">üó∫Ô∏è</div><div class="pr-content"><div class="val">${fmt(totalMi,1)} mi</div><div class="desc">Total Mileage ‚Äî All Time</div></div></div>`;
  document.getElementById('prList').innerHTML=html;
}

function addWorkout(){
  let w={
    date:document.getElementById('wDate').value,
    type:document.getElementById('wType').value,
    duration:document.getElementById('wDuration').value,
    distance:parseFloat(document.getElementById('wDist').value)||null,
    pace:document.getElementById('wPace').value||null,
    hr:parseInt(document.getElementById('wHR').value)||null,
    cadence:parseInt(document.getElementById('wCad').value)||null,
    calories:parseInt(document.getElementById('wCal').value)||null,
    elevation:parseInt(document.getElementById('wElev').value)||null
  };
  if(!w.date||!w.duration){showToast('‚ö†Ô∏è Date and duration required');return;}
  workouts.push(w);
  workouts.sort((a,b)=>a.date.localeCompare(b.date));
  localStorage.setItem('cr_workouts',JSON.stringify(workouts));
  showToast('Workout saved!');
  renderLog();renderDash();renderPRs();
  // Reset form
  ['wDate','wDuration','wDist','wPace','wHR','wCad','wCal','wElev'].forEach(id=>document.getElementById(id).value='');
}

function addComp(){
  let c={
    date:document.getElementById('cDate').value,
    weight:parseFloat(document.getElementById('cWeight').value)||null,
    bmi:parseFloat(document.getElementById('cBMI').value)||null,
    bf:parseFloat(document.getElementById('cBF').value)||null,
    muscle:parseFloat(document.getElementById('cMuscle').value)||null,
    skeletal:parseFloat(document.getElementById('cSkeletal').value)||null,
    fatfree:parseFloat(document.getElementById('cFatFree').value)||null,
    visceral:parseInt(document.getElementById('cVisceral').value)||null
  };
  if(!c.date){showToast('‚ö†Ô∏è Date required');return;}
  comps.push(c);
  comps.sort((a,b)=>a.date.localeCompare(b.date));
  localStorage.setItem('cr_comps',JSON.stringify(comps));
  showToast('Body comp saved!');
  ['cDate','cWeight','cBMI','cBF','cMuscle','cSkeletal','cFatFree','cVisceral'].forEach(id=>document.getElementById(id).value='');
}

// Init
renderDash();renderProgressSummary();renderLog();renderPRs();
// Lazy-load run/body charts only when tab visited
</script>
</body>
</html>
